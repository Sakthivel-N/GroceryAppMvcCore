@model IEnumerable<GroceryAppMvcCore.Models.Product>

@{
    ViewData["Title"] = "ViewProducts";
    Layout = "~/Views/Shared/_UsersLayout.cshtml";
    int CategoryID = Convert.ToInt32(ViewBag.CategoryId);
    ProductView obj = new ProductView();
    obj.Products = new List<Product>();
    obj.Count = 0;

}
@if (ViewBag.Msg != null)
{
    <h2>@ViewBag.Msg</h2>

}

<h1>ViewProducts</h1>

@*<p>
    <a asp-action="Create">Create New</a>
    </p>*@

<environment names="Development">
    <link rel="stylesheet" href="~/css/StyleSheet.css" />
</environment>
<br>

<div class="uk-container">
    <hr class="uk-divider-icon">
    <div class="uk-child-width-1-3@m uk-grid-match uk-child-width-1-2@s" uk-grid>

        @foreach (var product in Model)
        {
            if (CategoryID < 4)
            {
                if (obj.Count == 3)
                {
                    obj.Count = 0;
                    @await Html.PartialAsync("ProductCard", obj)
                    obj.Products = null;
                }
                else if (product.CategoryId == CategoryID & obj.Count < 3)
                {
                    obj.Products.Add(product);
                    obj.Count += 1;
                }


            }

            else
            {
                if (obj.Count == 3)
                {
                    obj.Count = 0;
                    @await Html.PartialAsync("ProductCard", obj)
                    obj.Products = null;
                }   
                else if (obj.Count < 3)
                {
                    obj.Products.Add(product);
                    obj.Count += 1;
                }
            }

        }
        @if(obj.Products!=null & obj.Count<3 & obj.Count>0){

            @await Html.PartialAsync("ProductCard", obj)

        }
        else if (obj.Products == null)
        {
            @await Html.PartialAsync("ProductCard", obj)
        }


    </div>
    <br />
    <br />


</div>
